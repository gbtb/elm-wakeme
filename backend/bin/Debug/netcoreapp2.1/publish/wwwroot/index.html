<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Wakeme</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="index.js"></script>
    <script type="text/javascript" src="//localhost:35729/livereload.js?snipver=1" async="" defer=""></script>
</head>
<body>
    <div id="elm"></div>
</body>
<script>
var id, target, options;

var app = Elm.Main.init({
  node: document.getElementById('elm')
});

function success(rawPosition) {
    var coords = rawPosition.coords;

	var rawAltitude = coords.altitude;
	var rawAccuracy = coords.altitudeAccuracy;
	var altitude =
		(rawAltitude === null || rawAccuracy === null)
			? null
			: { value: rawAltitude, accuracy: rawAccuracy };

	var heading = coords.heading;
	var speed = coords.speed;
	var movement =
		(heading === null || speed === null)
			? null
			: 
				speed === 0
					? { Static: null }
					: { Moving: {speed: speed, degreesFromNorth: heading } }
			

	const ret = {
		latitude: coords.latitude,
		longitude: coords.longitude,
	    accuracy: coords.accuracy,
		altitude: altitude,
		movement: movement,
		timestamp: rawPosition.timestamp
    };
    app.ports.changes.send(ret);
}

function error(err) {
  console.warn('ERROR(' + err.code + '): ' + err.message);
}

options = {
  enableHighAccuracy: false,
  timeout: 5000,
  maximumAge: 0
};

id = navigator.geolocation.watchPosition(success, error, options);
</script>
</html>